# API 文档

## 卡密激活

用户使用卡密来兑换积分。

**HTTP 方法:** `POST`

**URL 路径:** `/api/v1/card-keys/activate`

**认证:**

此接口需要用户认证。请在请求头中包含有效的 `Authorization` 令牌。

```
Authorization: Bearer <your_jwt_token>
```

---

### 请求

**请求头:**

| Header          | Value                 | 描述             |
| --------------- | --------------------- | ---------------- |
| `Content-Type`  | `application/json`    | 请求体格式       |
| `Authorization` | `Bearer <jwt_token>` | 用户认证令牌     |

**请求体 (JSON):**

```json
{
  "card_key": "ABC123XYZ"
}
```

**请求体参数:**

| 字段名      | 类型    | 约束                                     | 描述                     |
| ----------- | ------- | ---------------------------------------- | ------------------------ |
| `card_key`  | `string` | 必填, 长度为9, 仅包含大写字母和数字 | 用户要激活的卡密字符串 |

---

### 响应

**成功响应 (200 OK):**

当卡密成功激活时，服务器返回以下 JSON 结构：

```json
{
  "credits": 100,
  "balance": 150,
  "message": "卡密激活成功"
}
```

**响应体参数:**

| 字段名    | 类型    | 描述                                       |
| --------- | ------- | ------------------------------------------ |
| `credits` | `integer` | 本次卡密激活增加的积分数量                 |
| `balance` | `integer` | 用户激活卡密后的当前总积分余额           |
| `message` | `string`  | 成功的提示信息                             |

**错误响应:**

*   **400 Bad Request:** 请求无效或业务逻辑错误。
    *   卡密不存在: `{"detail": "卡密不存在"}`
    *   卡密已被使用或失效: `{"detail": "卡密已被使用或已失效"}`
    *   卡密已过期: `{"detail": "卡密已过期"}`
    *   增加积分失败（通常是服务器内部问题）: `{"detail": "增加积分失败"}`
    *   其他业务错误...

    示例:
    ```json
    {
      "detail": "卡密已被使用或已失效"
    }
    ```

*   **401 Unauthorized:** 用户未认证或认证令牌无效。
    ```json
    {
      "detail": "Not authenticated" 
    }
    ```
    *注意: 具体的错误信息可能因认证中间件的实现而异。*

*   **422 Unprocessable Entity:** 请求体格式错误或参数验证失败。
    ```json
    {
      "detail": [
        {
          "loc": [
            "body",
            "card_key"
          ],
          "msg": "卡密只能包含大写字母和数字", 
          "type": "value_error" 
        }
      ]
    }
    ```
    *注意: 错误消息和结构取决于具体的验证错误。*

--- 